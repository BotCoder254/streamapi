<!-- Torrent Movie Details -->
<div class="animate__animated animate__fadeIn">
    <% if (movie) { %>
        <!-- Movie Background -->
        <div class="relative">
            <div class="absolute inset-0 bg-gradient-to-b from-transparent via-gray-900 to-gray-900"></div>
            <div class="absolute inset-0" style="background-image: url('<%= movie.background_image %>'); background-size: cover; background-position: center; filter: blur(2px) brightness(0.3);"></div>
            
            <!-- Movie Content -->
            <div class="relative container mx-auto px-4 py-12">
                <div class="flex flex-col md:flex-row gap-8">
                    <!-- Movie Poster -->
                    <div class="w-full md:w-1/3 lg:w-1/4">
                        <div class="relative rounded-lg overflow-hidden shadow-xl">
                            <img 
                                src="<%= movie.large_cover_image %>" 
                                alt="<%= movie.title %>" 
                                class="w-full"
                                onerror="this.onerror=null; this.src='https://via.placeholder.com/500x750?text=No+Poster';"
                            >
                        </div>
                    </div>
                    
                    <!-- Movie Info -->
                    <div class="flex-1">
                        <h1 class="text-4xl font-bold mb-2"><%= movie.title %> (<%= movie.year %>)</h1>
                        
                        <!-- Movie Meta -->
                        <div class="flex flex-wrap items-center gap-4 text-sm text-gray-300 mb-6">
                            <% if (movie.rating) { %>
                                <div class="flex items-center">
                                    <i class="fas fa-star text-yellow-500 mr-1"></i>
                                    <span><%= movie.rating %>/10</span>
                                </div>
                            <% } %>
                            
                            <% if (movie.runtime) { %>
                                <div class="flex items-center">
                                    <i class="fas fa-clock text-gray-500 mr-1"></i>
                                    <span><%= movie.runtime %> min</span>
                                </div>
                            <% } %>
                            
                            <% if (movie.language) { %>
                                <div class="flex items-center">
                                    <i class="fas fa-globe text-gray-500 mr-1"></i>
                                    <span><%= movie.language %></span>
                                </div>
                            <% } %>
                            
                            <% if (movie.genres && movie.genres.length > 0) { %>
                                <div class="flex flex-wrap gap-2">
                                    <% movie.genres.forEach(genre => { %>
                                        <a href="/torrent/results?genre=<%= genre.toLowerCase() %>" 
                                           class="px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-sm transition">
                                            <%= genre %>
                                        </a>
                                    <% }); %>
                                </div>
                            <% } %>
                        </div>
                        
                        <!-- Synopsis -->
                        <% if (movie.description_full) { %>
                            <div class="mb-8">
                                <h2 class="text-xl font-bold mb-3">Synopsis</h2>
                                <p class="text-gray-300 leading-relaxed"><%= movie.description_full %></p>
                            </div>
                        <% } %>
                        
                        <!-- Download Options -->
                        <% if (movie.torrents && movie.torrents.length > 0) { %>
                            <div class="mb-8">
                                <h2 class="text-xl font-bold mb-4">Download Options</h2>
                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <% movie.torrents.forEach(torrent => { %>
                                        <div class="bg-gray-800 rounded-lg p-4 hover:bg-gray-700 transition group">
                                            <div class="flex items-center justify-between mb-3">
                                                <span class="font-bold"><%= torrent.quality %></span>
                                                <span class="text-sm text-gray-400"><%= torrent.size %></span>
                                            </div>
                                            <div class="flex items-center justify-between text-sm">
                                                <div class="flex items-center text-gray-400">
                                                    <i class="fas fa-users mr-1"></i>
                                                    <span><%= torrent.seeds %> seeds</span>
                                                </div>
                                                <a href="<%= torrent.url %>" 
                                                   class="flex items-center text-green-500 hover:text-green-400 transition">
                                                    <i class="fas fa-download mr-1"></i>
                                                    <span>Download</span>
                                                </a>
                                            </div>
                                        </div>
                                    <% }); %>
                                </div>
                            </div>
                        <% } %>
                    </div>
                </div>
                
                <!-- Additional Info -->
                <div class="mt-12 grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Cast -->
                    <% if (movie.cast && movie.cast.length > 0) { %>
                        <div>
                            <h2 class="text-xl font-bold mb-4">Cast</h2>
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                                <% movie.cast.slice(0, 6).forEach(actor => { %>
                                    <div class="bg-gray-800 rounded-lg overflow-hidden group">
                                        <div class="relative pb-[100%]">
                                            <img 
                                                src="<%= actor.url_small_image %>" 
                                                alt="<%= actor.name %>"
                                                class="absolute inset-0 w-full h-full object-cover group-hover:scale-110 transition duration-300"
                                                onerror="this.onerror=null; this.src='https://via.placeholder.com/200x200?text=No+Image';"
                                            >
                                        </div>
                                        <div class="p-2 text-center">
                                            <h3 class="font-medium truncate"><%= actor.name %></h3>
                                            <p class="text-sm text-gray-400 truncate"><%= actor.character_name %></p>
                                        </div>
                                    </div>
                                <% }); %>
                            </div>
                        </div>
                    <% } %>
                    
                    <!-- Similar Movies -->
                    <% if (movie.similar_movies && movie.similar_movies.length > 0) { %>
                        <div>
                            <h2 class="text-xl font-bold mb-4">Similar Movies</h2>
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                                <% movie.similar_movies.slice(0, 6).forEach(similar => { %>
                                    <a href="/torrent/movie/<%= similar.id %>" class="block bg-gray-800 rounded-lg overflow-hidden group">
                                        <div class="relative pb-[150%]">
                                            <img 
                                                src="<%= similar.medium_cover_image %>" 
                                                alt="<%= similar.title %>"
                                                class="absolute inset-0 w-full h-full object-cover group-hover:scale-110 transition duration-300"
                                                onerror="this.onerror=null; this.src='https://via.placeholder.com/300x450?text=No+Poster';"
                                            >
                                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                                                <span class="text-white px-3 py-1 rounded-full font-bold bg-green-600/80 transform scale-0 group-hover:scale-100 transition-transform duration-300">View Details</span>
                                            </div>
                                        </div>
                                        <div class="p-2">
                                            <h3 class="font-medium truncate"><%= similar.title %></h3>
                                            <div class="flex items-center text-sm text-gray-400">
                                                <i class="fas fa-star text-yellow-500 mr-1"></i>
                                                <span><%= similar.rating %>/10</span>
                                            </div>
                                        </div>
                                    </a>
                                <% }); %>
                            </div>
                        </div>
                    <% } %>
                </div>
                
                <!-- Screenshots -->
                <% if (movie.large_screenshot_image1 || movie.large_screenshot_image2 || movie.large_screenshot_image3) { %>
                    <div class="mt-12">
                        <h2 class="text-xl font-bold mb-4">Screenshots</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <% [movie.large_screenshot_image1, movie.large_screenshot_image2, movie.large_screenshot_image3].forEach(screenshot => { %>
                                <% if (screenshot) { %>
                                    <div class="relative rounded-lg overflow-hidden group cursor-pointer">
                                        <img 
                                            src="<%= screenshot %>" 
                                            alt="Movie Screenshot"
                                            class="w-full h-auto group-hover:scale-105 transition duration-300"
                                            onerror="this.onerror=null; this.src='https://via.placeholder.com/1280x720?text=No+Screenshot';"
                                        >
                                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                                            <i class="fas fa-search-plus text-2xl"></i>
                                        </div>
                                    </div>
                                <% } %>
                            <% }); %>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    <% } else { %>
        <!-- Error State -->
        <div class="container mx-auto px-4 py-16 text-center">
            <i class="fas fa-film text-5xl text-gray-600 mb-4"></i>
            <h2 class="text-2xl font-bold mb-2">Movie Not Found</h2>
            <p class="text-gray-400 mb-6">The movie you're looking for might have been removed or doesn't exist.</p>
            <a href="/torrent/search" class="inline-block px-6 py-3 bg-green-600 hover:bg-green-700 rounded-lg transition">
                Back to Search
            </a>
        </div>
    <% } %>
</div>

<!-- WebTorrent Client Script -->
<script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize WebTorrent Client
    const client = new WebTorrent();
    
    // Handle screenshot clicks (lightbox view can be implemented here)
    document.querySelectorAll('.screenshots img').forEach(img => {
        img.addEventListener('click', function() {
            // Implement lightbox view
        });
    });
});
</script> 